<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birthday Quest: Secret Level</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #0f172a;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: #f8fafc;
            overflow-x: hidden;
        }

        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
        }

        .active { display: flex; }

        /* –õ–æ–≥–æ—Ç–∏–ø */
        #logo-text {
            font-size: 3rem;
            letter-spacing: 10px;
            font-weight: bold;
            animation: logoAnim 4s forwards;
        }

        @keyframes logoAnim {
            0% { opacity: 0; transform: scale(0.8); filter: blur(10px); }
            50% { opacity: 1; transform: scale(1); filter: blur(0); }
            100% { opacity: 0; }
        }

        /* –ü–æ–ª–µ –ø–∞—Ä–æ–ª—è */
        #password-area {
            margin-top: 20px;
            display: none;
            flex-direction: column;
            gap: 15px;
            animation: fadeIn 1s forwards;
        }

        input[type="password"] {
            padding: 12px 20px;
            border-radius: 25px;
            border: 2px solid #fbbf24;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            width: 300px;
            outline: none;
            text-align: center;
        }

        .unlock-btn, .cheese-btn {
            padding: 12px 30px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            color: #0f172a;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1.1rem;
            margin: 10px;
        }

        .unlock-btn:hover, .cheese-btn:hover { 
            background: linear-gradient(45deg, #f59e0b, #d97706);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.3);
        }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        h1 { color: #fbbf24; margin-bottom: 10px; }
        
        .message-box {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            max-width: 700px;
            line-height: 1.6;
            margin: 20px 0;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        #ai-text {
            white-space: pre-wrap;
            text-align: left;
            border-left: 3px solid #fbbf24;
            padding-left: 15px;
            color: #e2e8f0;
        }

        .book-img {
            width: 200px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .book-img:hover { transform: scale(1.1) rotate(-3deg); }

        .signature { 
            font-size: 0.75rem; 
            color: #475569; 
            margin-top: 20px;
            font-family: monospace;
        }

        /* –°–¢–ò–õ–ò –î–õ–Ø –°–´–†–ù–û–ô –õ–ê–ë–û–†–ê–¢–û–†–ò–ò */
        .cheese-header {
            color: #ffd166;
            text-shadow: 0 0 10px rgba(255, 209, 102, 0.5);
            margin-bottom: 20px;
        }

        .lab-container {
            background: rgba(44, 27, 15, 0.7);
            border-radius: 20px;
            padding: 30px;
            border: 3px solid #f4a261;
            box-shadow: 0 0 40px rgba(244, 162, 97, 0.3);
            max-width: 800px;
            margin: 20px auto;
        }

        #video {
            width: 100%;
            max-width: 500px;
            border-radius: 15px;
            border: 4px solid #ffd166;
            transform: scaleX(-1); /* –ó–µ—Ä–∫–∞–ª–∏–º –¥–ª—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
            margin: 20px 0;
        }

        #canvas {
            display: none;
        }

        .cheese-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        /* –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .cheese-loader {
            width: 80px;
            height: 80px;
            border: 8px solid #ffd166;
            border-top: 8px solid #f4a261;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin-bottom: 30px;
        }

        #loading-text {
            font-size: 1.5rem;
            color: #ffd166;
            text-align: center;
            margin-top: 20px;
            animation: pulse 2s infinite;
        }

        #result-image {
            max-width: 90%;
            max-height: 500px;
            border-radius: 15px;
            border: 5px solid #fbbf24;
            margin-top: 20px;
            display: none;
        }

        .back-btn {
            margin-top: 30px;
            padding: 10px 20px;
            background: #475569;
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
        }

        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes fadeIn { 
            from { opacity: 0; } 
            to { opacity: 1; } 
        }

        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }

        @keyframes pulse { 
            0%, 100% { opacity: 0.7; } 
            50% { opacity: 1; } 
        }

        @keyframes cheeseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 209, 102, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 209, 102, 0.8); }
        }

        .cheese-glow {
            animation: cheeseGlow 2s infinite;
        }
    </style>
</head>
<body>

    <!-- –≠–ö–†–ê–ù 0: –õ–û–ì–û -->
    <div id="screen-0" class="screen active">
        <div id="logo-text">LEVA PRODUCTIONS</div>
    </div>

    <!-- –≠–ö–†–ê–ù 1: –ü–†–ò–í–ï–¢–°–¢–í–ò–ï -->
    <div id="screen-1" class="screen">
        <h1>Happy Birthday, Mom!</h1>
        <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—é –Ω—É–∂–µ–Ω "–∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞"...</p>
        
        <div id="book-trigger">
            <img src="https://ir.ozone.ru/s3/multimedia-2/c1000/6818803850.jpg" class="book-img" onclick="showPasswordInput()" alt="Book 1">
            <p style="margin-top: 10px; color: #fbbf24;">–ù–∞–∂–º–∏ –Ω–∞ —É—á–µ–±–Ω–∏–∫, —á—Ç–æ–±—ã –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å</p>
        </div>

        <div id="password-area">
            <input type="password" id="api-key-input" placeholder="–í–≤–µ–¥–∏—Ç–µ API-–∫–ª—é—á –∫–∞–∫ –ø–∞—Ä–æ–ª—å...">
            <button class="unlock-btn" onclick="startFinalPage()">–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥–∞—Ä–æ–∫</button>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù 2: –¢–ê–ô–ù–û–ï –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–ï -->
    <div id="screen-2" class="screen">
        <h1>Secret Greeting Unlocked</h1>
        
        <div class="message-box">
            <!-- –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç -->
            <p><strong>–ú–æ–π —Ç–µ–∫—Å—Ç:</strong> –î–æ—Ä–æ–≥–∞—è –º–∞–º–∞! –ú—ã —Ä–µ—à–∏–ª–∏, —á—Ç–æ –æ–±—ã—á–Ω—ã—Ö —Å–ª–æ–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, –ø–æ—ç—Ç–æ–º—É –ø–æ–¥–∫–ª—é—á–∏–ª–∏ –º–æ—â—å –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞, —á—Ç–æ–±—ã –æ–Ω –≤—ã—Ä–∞–∑–∏–ª –≤—Å—é –≥–ª—É–±–∏–Ω—É –Ω–∞—à–∏—Ö —á—É–≤—Å—Ç–≤ –∫ —Ç–µ–±–µ. –ü–æ—Å–º–æ—Ç—Ä–∏, –∫–∞–∫ –æ–Ω —Å—Ç–∞—Ä–∞–µ—Ç—Å—è:</p>
            
            <div id="ai-text">–û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç –Ω–µ–π—Ä–æ—Å–µ—Ç–∏...</div>
        </div>

        <div class="signature">–ù–µ–π—Ä–æ—Å–µ—Ç—å –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é OpenRouter AI API | streaming mode</div>

        <div style="margin-top: 30px;">
            
            <div style="margin-top: 20px;">
                <a href="index.html" target="_blank">
                    <img src="https://avatars.mds.yandex.net/get-mpic/4420180/img_id6877734780920020011.jpeg/orig" class="book-img" alt="Book 2">
                </a>
                <p style="font-size: 0.8rem; margin-top: 10px;">The Ultimate English Guide for the Best Mom</p>
            </div>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù 3: –°–´–†–ù–ê–Ø –õ–ê–ë–û–†–ê–¢–û–†–ò–Ø -->
    <div id="screen-3" class="screen">
        <h1 class="cheese-header">üßÄ –°–ï–ö–†–ï–¢–ù–ê–Ø –°–´–†–ù–ê–Ø –õ–ê–ë–û–†–ê–¢–û–†–ò–Ø üßÄ</h1>
        
        <div class="lab-container">
            <p style="margin-bottom: 20px; font-size: 1.1rem;">
                <strong>–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç:</strong> –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞ –≤ —Å—ã—Ä–Ω—É—é —Ñ–æ—Ä–º—É —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π
            </p>
            
            <div id="camera-container">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
            </div>
            
            <div class="cheese-controls">
                <button class="cheese-btn" onclick="startCamera()" id="start-camera-btn">
                    üì∑ –ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –ö–ê–ú–ï–†–£
                </button>
                <button class="cheese-btn" onclick="capturePhoto()" id="capture-btn" style="display: none;">
                    üßÄ –°–§–û–¢–û–ì–†–ê–§–ò–†–û–í–ê–¢–¨ –°–´–†–ù–´–ô –û–ë–™–ï–ö–¢
                </button>
                <button class="cheese-btn" onclick="goBack()">
                    üîô –ù–ê–ó–ê–î –ö –ü–û–ó–î–†–ê–í–õ–ï–ù–ò–Æ
                </button>
            </div>
            
            <p style="font-size: 0.9rem; color: #f4a261; margin-top: 20px;">
                ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–µ—Ä–µ–¥–æ–≤—ã–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.<br>
                –†–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å... —Å—ã—Ä–Ω—ã–º!
            </p>
        </div>
        
        <div class="signature">CheeseLab v3.14 | Lev–∞ Productions Experimental Division</div>
    </div>

    <!-- –≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò -->
    <div id="loading-screen">
        <div class="cheese-loader"></div>
        <h2 style="color: #ffd166; margin-bottom: 10px;">–°–´–†–ù–ê–Ø –¢–†–ê–ù–°–§–û–†–ú–ê–¶–ò–Ø</h2>
        <div id="loading-text">–ü–æ–¥–æ–∂–¥–∏—Ç–µ —á—É—Ç—å-—á—É—Ç—å...</div>
        <p style="color: #94a3b8; margin-top: 20px;">
            –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ—Ç–æ –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å—ã—Ä–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã...
        </p>
        
        <!-- –ê—É–¥–∏–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (—Å–∫—Ä—ã—Ç–æ–µ) -->
        <audio id="loading-music" loop>
            <!-- –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∞—à—É –º—É–∑—ã–∫—É –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª -->
            <source src="–≤–∞—à–∞-–º—É–∑—ã–∫–∞.mp3" type="audio/mpeg">
            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ
        </audio>
        
        <img id="result-image" alt="–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏">
        <button class="back-btn" onclick="hideResult()" style="display: none; margin-top: 20px;">
            –°–î–ï–õ–ê–¢–¨ –ï–©–ï –û–î–ù–£ –§–û–¢–û
        </button>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let USER_API_KEY = "";
        let stream = null;
        let currentScreen = 'screen-0';

        // –†–æ—Ç–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–æ–≤
        setTimeout(() => {
            transitionScreens('screen-0', 'screen-1');
        }, 4000);

        function transitionScreens(hideId, showId) {
            document.getElementById(hideId).style.display = 'none';
            document.getElementById(showId).style.display = 'flex';
            currentScreen = showId;
        }

        function showPasswordInput() {
            document.getElementById('password-area').style.display = 'flex';
            document.getElementById('book-trigger').style.opacity = '0.5';
        }

        async function startFinalPage() {
            const key = document.getElementById('api-key-input').value;
            if (!key || key.length < 10) {
                alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π API –∫–ª—é—á (–ø–∞—Ä–æ–ª—å)");
                return;
            }
            USER_API_KEY = key;
            transitionScreens('screen-1', 'screen-2');
            runAiStreaming();
        }

        // –õ–æ–≥–∏–∫–∞ –ø–æ—Ç–æ–∫–æ–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
        async function runAiStreaming() {
            const container = document.getElementById('ai-text');
            const prompt = "–ù–∞–ø–∏—à–∏ —Ç–µ–ø–ª–æ–µ, –æ—á–µ–Ω—å –¥–æ–±—Ä–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–∞–º—ã —Å –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ —Å –≤–∫—Ä–∞–ø–ª–µ–Ω–∏—è–º–∏ –∫—Ä–∞—Å–∏–≤—ã—Ö –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å–ª–æ–≤. –ù–∞–ø–∏—à–∏ –æ —Ç–æ–º, –∫–∞–∫–∞—è –æ–Ω–∞ –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–∞—è.–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π markdown —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç";
            
            container.innerText = "";

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${USER_API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": "openai/gpt-oss-120b",
                        "messages": [{ "role": "user", "content": prompt }],
                        "stream": true
                    })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder("utf-8");

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split("\n");

                    for (const line of lines) {
                        if (line.startsWith("data: ")) {
                            const dataStr = line.replace("data: ", "");
                            if (dataStr === "[DONE]") break;
                            try {
                                const data = JSON.parse(dataStr);
                                const content = data.choices[0].delta.content || "";
                                container.innerText += content;
                            } catch (e) {}
                        }
                    }
                }
            } catch (err) {
                container.innerText = "–£–ø—Å! –ö–∞–∂–µ—Ç—Å—è, –ø–∞—Ä–æ–ª—å (–∫–ª—é—á) –Ω–µ –ø–æ–¥–æ—à–µ–ª. –ù–æ –≥–ª–∞–≤–Ω–æ–µ ‚Äî –º—ã —Ç–µ–±—è –ª—é–±–∏–º!";
                console.error(err);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –°—ã—Ä–Ω–æ–π –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏
        function goToCheeseLab() {
            transitionScreens('screen-2', 'screen-3');
        }

        function goBack() {
            transitionScreens('screen-3', 'screen-2');
        }

        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                const video = document.getElementById('video');
                video.srcObject = stream;
                
                document.getElementById('start-camera-btn').style.display = 'none';
                document.getElementById('capture-btn').style.display = 'block';
                
                video.classList.add('cheese-glow');
                
            } catch (err) {
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.");
                console.error("Camera error:", err);
            }
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            showLoadingScreen();
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ç–æ –≤ –Ω–µ–π—Ä–æ—Å–µ—Ç—å —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É (–¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞)
            setTimeout(() => sendToAI(canvas), 1000);
        }

        function showLoadingScreen() {
            const loadingScreen = document.getElementById('loading-screen');
            loadingScreen.style.display = 'flex';
            
            // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –º—É–∑—ã–∫—É, –µ—Å–ª–∏ –µ—Å—Ç—å
            const music = document.getElementById('loading-music');
            if (music.src) {
                music.volume = 0.3;
                music.play().catch(e => console.log("Audio play failed:", e));
            }
            
            // –ú–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
            const texts = [
                "–ü–æ–¥–æ–∂–¥–∏—Ç–µ —á—É—Ç—å-—á—É—Ç—å...",
                "–î–æ–±–∞–≤–ª—è–µ–º —Å—ã—Ä–Ω—ã–µ –Ω–æ—Ç–∫–∏...",
                "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–∏–∫—Å–µ–ª–∏...",
                "–°–æ–∑–¥–∞–µ–º –≤–∫—É—Å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç...",
                "–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ..."
            ];
            
            let index = 0;
            const textElement = document.getElementById('loading-text');
            
            const textInterval = setInterval(() => {
                textElement.textContent = texts[index];
                index = (index + 1) % texts.length;
            }, 3000);
            
            window.loadingTextInterval = textInterval;
        }

        async function sendToAI(canvas) {
            try {
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ñ–æ—Ç–æ –≤ base64
                const imageData = canvas.toDataURL('image/jpeg', 0.8);
                const base64Data = imageData.split(',')[1];
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ OpenRouter –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const response = await fetch("https://openrouter.ai/api/v1/images/generations", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${USER_API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": "google/gemini-2.5-flash-image",
                        "prompt": "–ü—Ä–µ–≤—Ä–∞—Ç–∏ —ç—Ç–æ —Ñ–æ—Ç–æ –≤ –≤–µ—Å–µ–ª–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞-—Å—ã—Ä–∞. –°–¥–µ–ª–∞–π —á–µ–ª–æ–≤–µ–∫–∞ –≤ –≤–∏–¥–µ —Å—ã—Ä–∞ –≤ –º—É–ª—å—Ç—è—à–Ω–æ–º —Å—Ç–∏–ª–µ. –Ø—Ä–∫–∏–µ —Ü–≤–µ—Ç–∞, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –≤–∏–¥, —Å—ã—Ä–Ω—ã–µ –¥–µ—Ç–∞–ª–∏. –°—Ç–∏–ª—å: –¥–æ–±—Ä—ã–π –º—É–ª—å—Ç—Ñ–∏–ª—å–º",
                        "n": 1,
                        "size": "512x512",
                        "response_format": "url"
                    })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                showResult(data.data[0].url);
                
            } catch (err) {
                console.error("AI Error:", err);
                document.getElementById('loading-text').textContent = 
                    "–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏! –ù–æ —Ç—ã –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–∞–º–∞—è —Å—ã—Ä–Ω–∞—è –º–∞–º–∞! üßÄ";
                    
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
                setTimeout(() => {
                    document.getElementById('loading-text').textContent = "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!";
                    document.querySelector('.back-btn').style.display = 'block';
                }, 3000);
            }
        }

        function showResult(imageUrl) {
            clearInterval(window.loadingTextInterval);
            
            const resultImage = document.getElementById('result-image');
            const loadingText = document.getElementById('loading-text');
            const backBtn = document.querySelector('.back-btn');
            
            resultImage.src = imageUrl;
            resultImage.style.display = 'block';
            loadingText.textContent = "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ";
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º—É–∑—ã–∫—É
            const music = document.getElementById('loading-music');
            music.pause();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            setTimeout(() => {
                backBtn.style.display = 'block';
            }, 2000);
        }

        function hideResult() {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('result-image').style.display = 'none';
            document.querySelector('.back-btn').style.display = 'none';
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é
            transitionScreens(currentScreen, 'screen-3');
        }
    </script>
</body>
</html>